<!DOCTYPE html>
<html>
<head>
	<title>Image Recognition</title>

	<!-- <link rel="stylesheet" href="static/components/element-ui/index.css"> -->
	<link rel="stylesheet" href="https://unpkg.com/element-ui@2.12.0/lib/theme-chalk/index.css">
</head>
<body>
	
	<div id="app-container">
		<!-- <el-upload
			class="upload-demo"
			action="/upload"
			:on-preview="handlePreview"
			:on-remove="handleRemove"
			:file-list="fileList"
			:multiple="true"
			list-type="picture">
			<el-button size="small" type="primary">点击上传</el-button>
		</el-upload> -->

		<!-- <el-row>
			<el-col :span="24" style="text-align: right;margin-bottom: 10px;">
				<el-button type="primary" icon="el-icon-upload" @click="uploadVisible = true">上传</el-button>
				<el-button type="success" icon="el-icon-check">保存</el-button>
			</el-col>
		</el-row>

		<el-row>
			<el-col style="border: 1px solid;">sad</el-col>
		</el-row> -->

		<!-- <el-dialog :visible.sync="uploadVisible" title="选择图片"> -->
			<!-- <el-upload
				action="#"
				list-type="picture-card"
				:multiple="true"
				:auto-upload="false">
				<i slot="default" class="el-icon-plus"></i>
				<div slot="file" slot-scope="{file}">
					<img class="el-upload-list__item-thumbnail" :src="file.url">
					<span class="el-upload-list__item-actions">
						<span
							class="el-upload-list__item-preview"
							@click="handlePictureCardPreview(file)">
							<i class="el-icon-zoom-in"></i>
						</span>
						<span
							v-if="!disabled"
							class="el-upload-list__item-delete"
							@click="handleDownload(file)">
							<i class="el-icon-download"></i>
						</span>
						<span
							v-if="!disabled"
							class="el-upload-list__item-delete"
							@click="handleRemove(file)">
							<i class="el-icon-delete"></i>
						</span>
					</span>
				</div>
			</el-upload> -->
			<!-- <el-upload
				action="#"
				list-type="picture-card"
				:multiple="true"
				:auto-upload="false"
				:on-preview="handlePictureCardPreview"
				:on-remove="handleRemove">
				<i class="el-icon-plus"></i>
			</el-upload> -->
		<!-- </el-dialog> -->

		<el-row>
			<el-col>
				<div style="text-align: right;margin-bottom: 10px;">
					<el-button type="primary" icon="el-icon-upload" @click="submitFile">上传</el-button>
					<el-button type="success" icon="el-icon-check" @click="">保存</el-button>
				</div>
				<el-upload
					ref="upload"
					action="#"
					list-type="picture-card"
					:multiple="true"
					:auto-upload="false"
					:http-request="appendFile"
					:on-preview="handlePictureCardPreview">
					<i class="el-icon-plus"></i>
				</el-upload>
			</el-col>
		</el-row>

		<el-row>
			<el-col>
				<div v-for="md in metadatas" :key="md.final_name">
					<el-image style="width: 200px; height: 200px" :src="md.filepath" :fit="fit" :preview-src-list="srcList" lazy></el-image>
				</div>
			</el-col>
		</el-row>

		<!-- <el-card class="box-card">
			<div slot="header" class="clearfix">
				<span>上传图片</span>
				<el-button style="float: right; padding: 3px 0" type="text">上传</el-button>
			</div>
			<el-upload
				action="#"
				list-type="picture-card"
				:multiple="true"
				:auto-upload="false"
				:on-preview="handlePictureCardPreview"
				:on-remove="handleRemove">
				<i class="el-icon-plus"></i>
			</el-upload>
		</el-card>

		<el-card class="box-card">
			<div slot="header" class="clearfix">
				<span>yu</span>
				<el-button style="float: right; padding: 3px 0" type="text">上传</el-button>
			</div>
			<div v-for="o in 4" :key="o" class="text item">
		    {{'列表内容 ' + o }}
		  </div>
		</el-card> -->

		<el-dialog :visible.sync="previewVisible">
			<img width="100%" :src="previewImageUrl">
		</el-dialog>
	</div>

</body>

	<script src="static/components/vue/vue.js"></script>
	<!-- <script src="static/components/element-ui/index.js"></script> -->
	<script src="https://unpkg.com/element-ui@2.12.0/lib/index.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
	new Vue({
		el: '#app-container',
		data: function() {
			return {
				previewImageUrl: '',
				previewVisible: false,
				formData: null,
				metadatas: [{"original_name":"sublime.jpg","final_name":"20191025180423380216_final_sublime.jpg","filepath":"./static/repos/20191025180423380216_sublime.jpg"},{"original_name":"sample.jpeg","final_name":"20191025180423405119_final_sample.jpeg","filepath":"./static/repos/20191025180423405119_sample.jpeg"},{"original_name":"notes.png","final_name":"20191025180423485906_final_notes.png","filepath":"./static/repos/20191025180423485906_notes.png"}]
			}
		},
		methods: {
			appendFile(file) {
				this.formData.append('file', file.file);
			},
			submitFile() {
				this.formData = new FormData();
				this.\$refs.upload.submit();

				axios.post('/upload', this.formData, {
					headers: { 'Content-Type': 'multipart/form-data' }
				}).then(({ data = [] }) => {
					console.info(JSON.stringify(data))
					// console.info(res.data)
					// console.info(typeof res.data)
					// console.info(JSON.parse(res.data))
					this.metadatas = data;
				}).catch(res => {
					console.error('upload error: ' + res);
				})
			},
			// handleRemove(file, fileList) {
			// 	// :on-remove="handleRemove"
			// 	console.log(file, fileList);
			// },
			handlePictureCardPreview(file) {
				this.previewImageUrl = file.url;
				this.previewVisible = true;
			}
		}
	});
  </script>
</html>
